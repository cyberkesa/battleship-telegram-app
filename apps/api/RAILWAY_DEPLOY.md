# üöÄ Railway Deployment Guide

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥–µ–ø–ª–æ—é

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ Railway

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [Railway.app](https://railway.app)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

1. –í –ø—Ä–æ–µ–∫—Ç–µ Railway –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å "PostgreSQL"
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `DATABASE_URL`
3. –î–æ–±–∞–≤—å—Ç–µ –µ—ë –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤–∞—à–µ–≥–æ API —Å–µ—Ä–≤–∏—Å–∞

–î–æ–±–∞–≤—å—Ç–µ —Å–µ—Ä–≤–∏—Å "Redis" –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `REDIS_URL` ‚Äî –æ–Ω —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –æ—á–µ—Ä–µ–¥–∏ –º–∞—Ç—á–º–µ–π–∫–∏–Ω–≥–∞.

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API —Å–µ—Ä–≤–∏—Å–∞

1. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å "GitHub Repo"
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `battleship-telegram-app`
3. –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ API: `apps/api`
4. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç `Dockerfile` –∏ —Å–æ–±–µ—Ä–µ—Ç –æ–±—Ä–∞–∑

### 4. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Railway ‚Üí API —Å–µ—Ä–≤–∏—Å)

```env
# Database
DATABASE_URL=postgresql://...

# JWT
JWT_SECRET=your-super-secret-jwt-key

# Frontend URL (Vercel)
FRONTEND_URL=https://your-frontend-domain.vercel.app

# Telegram Bot (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
TELEGRAM_BOT_TOKEN=your-bot-token
TELEGRAM_BOT_USERNAME=your-bot-username

# Redis (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—á–µ—Ä–µ–¥—å –º–∞—Ç—á–º–µ–π–∫–∏–Ω–≥–∞)
REDIS_URL=redis://...

# Environment
NODE_ENV=production
PORT=3000
```

–í–∞–∂–Ω–æ: –≤ –Ω–∞—à–µ–º –æ–±—Ä–∞–∑–µ –≤–∫–ª—é—á–µ–Ω healthcheck `GET /health`. –°—Ç–∞—Ä—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–∞.

### 5. –î–µ–ø–ª–æ–π –∏ –º–∏–≥—Ä–∞—Ü–∏–∏

- –ü—Ä–∏ –¥–µ–ø–ª–æ–µ Railway –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `apps/api/railway.json`:
  - `startCommand`: `npm run start:prod:migrate` ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç `prisma migrate deploy`, –∑–∞—Ç–µ–º —Å—Ç–∞—Ä—Ç—É–µ—Ç —Å–µ—Ä–≤–µ—Ä
  - `healthcheckPath`: `/api/health`
- Prisma Client –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ `postinstall`

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. Health Check: `https://<your-api>.railway.app/health`
2. –ë–∞–∑–æ–≤—ã–µ —ç–Ω–¥–ø–æ–π–Ω—Ç—ã:
   - POST `https://<your-api>.railway.app/api/auth/telegram`
   - POST `https://<your-api>.railway.app/api/lobby/create` (—Ç—Ä–µ–±—É–µ—Ç—Å—è JWT)

### 7. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º (Vercel)

- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ Vercel –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
  - `VITE_API_URL=https://<your-api>.railway.app/api`
- –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ Vercel.

### 8. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

- –í `@BotFather`:
  - `/setmenubutton` ‚Äî URL: `https://<your-frontend>.vercel.app`
  - `/setcommands` ‚Äî –∫–æ–º–∞–Ω–¥—ã: `start`, `help`, `stats`
- –î–ª—è –≤–µ–±—Ö—É–∫–∞ –±–æ—Ç–∞ (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –∏–º–µ–Ω–Ω–æ webhook):
  - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π URL API –∏ –∑–∞–¥–∞–π—Ç–µ webhook –∑–∞–ø—Ä–æ—Å–æ–º `setWebhook` –∫ Telegram API, —É–∫–∞–∑—ã–≤–∞—è `https://<your-api>.railway.app/bot/webhook` (–µ—Å–ª–∏ —ç–Ω–¥–ø–æ–π–Ω—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω).

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –°–±–æ—Ä–∫–∞
npm run build

# –ó–∞–ø—É—Å–∫ –≤ production —Ä–µ–∂–∏–º–µ
npm run start:prod

# –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
npm run db:migrate:prod

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma –∫–ª–∏–µ–Ω—Ç–∞
npm run db:generate
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

Railway –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
- –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

## Troubleshooting

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
npx prisma db pull

# –°–±—Ä–æ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ!)
npx prisma migrate reset
```

### CORS
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `FRONTEND_URL` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–¥–∞–Ω –∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å Vercel –¥–æ–º–µ–Ω–æ–º.

### JWT
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `JWT_SECRET` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ª–æ–∂–Ω—ã–π.
